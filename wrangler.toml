name = "coindrop-kr"
compatibility_date = "2024-11-02"
pages_build_output_dir = ".next"

# Cloudflare Pages Functions 설정
# Next.js API Routes가 자동으로 Functions로 변환됨

[env.production]
routes = [
  { pattern = "coindrop.kr", zone_name = "coindrop.kr" },
  { pattern = "www.coindrop.kr", zone_name = "coindrop.kr" }
]

# 프로덕션 환경 설정
# ⚠️ 배포 전에 실제 리소스 ID를 입력해야 합니다
# CLOUDFLARE_SETUP.md 파일 참고

# D1 Database (프로덕션)
[[env.production.d1_databases]]
binding = "DB"
database_name = "coindrop-db"
database_id = "" # ⚠️ 필수: Cloudflare Dashboard에서 생성 후 ID 입력
preview_database_id = ""
migrations_dir = "scripts/migrations"

# R2 Bucket (프로덕션)
[[env.production.r2_buckets]]
binding = "R2_CONTENTS"
bucket_name = "coindrop-contents"

[[env.production.r2_buckets]]
binding = "R2_BACKUPS"
bucket_name = "coindrop-backups"

# KV Namespaces (프로덕션)
# ⚠️ 주의: id가 빈 문자열이면 빌드 실패합니다
# 배포 전에 반드시 KV Namespace를 생성하고 ID를 입력하세요
[[env.production.kv_namespaces]]
binding = "KV_CACHE"
id = "" # ⚠️ 필수: 빈 문자열이면 안됩니다! KV Namespace ID 입력 필요
preview_id = ""

# Queues (프로덕션)
[[env.production.queues.producers]]
queue = "q.generate"
binding = "q"

# Variables (프로덕션)
[env.production.vars]
ENVIRONMENT = "production"
SCHEMA_VERSION = "101"
DEFAULT_CACHE_TTL_DETAIL = "600"
DEFAULT_CACHE_TTL_LIST = "300"
DEFAULT_CACHE_TTL_SITEMAP = "300"

# 로컬 개발용 기본 설정 (env.production이 아닌 환경에서 사용)
# 프로덕션 빌드에서는 사용되지 않습니다
[[d1_databases]]
binding = "DB"
database_name = "coindrop-db"
database_id = ""
preview_database_id = ""
migrations_dir = "scripts/migrations"

[[r2_buckets]]
binding = "R2_CONTENTS"
bucket_name = "coindrop-contents"

[[r2_buckets]]
binding = "R2_BACKUPS"
bucket_name = "coindrop-backups"

# 로컬 개발용 KV는 빈 id를 허용하지 않으므로 주석 처리
# 로컬 개발 시에는 preview_id만 사용하거나
# wrangler pages dev 명령어로 자동 생성된 리소스 사용
# [[kv_namespaces]]
# binding = "KV_CACHE"
# id = ""
# preview_id = ""

[[queues.producers]]
queue = "q.generate"
binding = "q"

[vars]
ENVIRONMENT = "development"
SCHEMA_VERSION = "101"
DEFAULT_CACHE_TTL_DETAIL = "600"
DEFAULT_CACHE_TTL_LIST = "300"
DEFAULT_CACHE_TTL_SITEMAP = "300"

# Secrets (wrangler secret put로 설정)
# Pages에서는 Cloudflare Dashboard의 Environment variables에서 설정
# OPENAI_API_KEY
# RESEND_API_KEY
# COLLECT_TOKEN
# REVALIDATE_TOKEN
# SENTRY_DSN
# MAKE_WEBHOOK_URL
# TELEGRAM_BOT_TOKEN
# TELEGRAM_CHAT_ID
